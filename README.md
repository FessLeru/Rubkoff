# Rubkoff House Selection Bot

Telegram –±–æ—Ç –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –¥–æ–º–æ–≤ –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ Rubkoff —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π **xtunnel.ru** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GPT –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞ –¥–æ–º–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ü§ñ **Telegram Bot** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Mini App
- üåê **Web API** —Å FastAPI  
- üè† **–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–æ–º–æ–≤**
- üì± **Telegram Mini App** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- üéØ **GPT-4 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –¥–ª—è —É–º–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- üìä **–°–∏—Å—Ç–µ–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è**
- üîÑ **–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö** —Å —Å–∞–π—Ç–∞ Rubkoff
- üíæ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** SQLite/PostgreSQL
- üîó **XTunnel.ru** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### ‚ö° –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–æ—â–µ –≤—Å–µ–≥–æ!)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```bash
# Windows - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
test_local.bat

# Linux/Mac
python xtunnel_server.py
```

**üéâ –ì–æ—Ç–æ–≤–æ! –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:**
- üì± **Mini App**: http://127.0.0.1:8000/frontend/
- üîó **API**: http://127.0.0.1:8000/api
- ‚ù§Ô∏è **Health Check**: http://127.0.0.1:8000/api/health

### üéØ –í–∞—Ä–∏–∞–Ω—Ç 1.5: –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ (Bot + Mini App + XTunnel)

–ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞ –≤ Mock —Ä–µ–∂–∏–º–µ + Mini App —á–µ—Ä–µ–∑ XTunnel:

```bash
# Windows - –∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ .env + –∑–∞–ø—É—Å–∫
start_run_both.bat

# Linux/Mac/Windows - –ø—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫
python run_both.py
```

**–ß—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**
- ü§ñ **Telegram Bot** –≤ Mock —Ä–µ–∂–∏–º–µ (–±—ã—Å—Ç—Ä—ã–π –ø–æ–¥–±–æ—Ä)
- üåê **Mini App** —á–µ—Ä–µ–∑ XTunnel.ru
- üì± **–î–æ—Å—Ç—É–ø**: https://–≤–∞—à_–ø–æ–¥–¥–æ–º–µ–Ω.xtunnel.ru/frontend/

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env –¥–ª—è XTunnel:**
```env
XTUNNEL_API_KEY=–≤–∞—à_–∫–ª—é—á_—Å_xtunnel_ru
XTUNNEL_SUBDOMAIN=my-rubkoff-app
BOT_TOKEN=–≤–∞—à_—Ç–µ–ª–µ–≥—Ä–∞–º_–±–æ—Ç_—Ç–æ–∫–µ–Ω
```

### üåê –í–∞—Ä–∏–∞–Ω—Ç 2: XTunnel.ru (–¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞)

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –¥–ª—è Telegram:

1. **–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ XTunnel:**
   - –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://cabinet.xtunnel.ru/
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏ –ø–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á
   - –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥–¥–æ–º–µ–Ω –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# Windows
set XTUNNEL_API_KEY=–≤–∞—à_–∫–ª—é—á_–∑–¥–µ—Å—å
set XTUNNEL_SUBDOMAIN=–≤–∞—à_–ø–æ–¥–¥–æ–º–µ–Ω

# Linux/Mac
export XTUNNEL_API_KEY=–≤–∞—à_–∫–ª—é—á_–∑–¥–µ—Å—å
export XTUNNEL_SUBDOMAIN=–≤–∞—à_–ø–æ–¥–¥–æ–º–µ–Ω
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
```bash
# Windows
start_xtunnel.bat

# Linux/Mac
python xtunnel_server.py
```

4. **üéâ –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç:**
   - üì± **Mini App**: https://–≤–∞—à_–ø–æ–¥–¥–æ–º–µ–Ω.xtunnel.ru/frontend/
   - üîó **API**: https://–≤–∞—à_–ø–æ–¥–¥–æ–º–µ–Ω.xtunnel.ru/api

### üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram –±–æ—Ç–æ–º —Å–æ–∑–¥–∞–π—Ç–µ `.env`:
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ
copy env-sample .env
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
rubkoff/
‚îú‚îÄ‚îÄ xtunnel_server.py           # üîó –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä —Å XTunnel
‚îú‚îÄ‚îÄ local_test_server.py        # üíª –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ main.py                     # ü§ñ Telegram Bot
‚îú‚îÄ‚îÄ start_xtunnel.bat          # üöÄ –ó–∞–ø—É—Å–∫ Windows
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/                   # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ models/                 # üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ services/               # üéØ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ bot/                    # ü§ñ Telegram –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ utils/                  # üîß –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ api/                    # üåê API –¥–ª—è Mini App
‚îî‚îÄ‚îÄ frontend/                   # üì± Mini App –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    ‚îú‚îÄ‚îÄ index.html
    ‚îú‚îÄ‚îÄ styles.css
    ‚îú‚îÄ‚îÄ script.js
    ‚îî‚îÄ‚îÄ assets/
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`:

```env
# Telegram Bot
BOT_TOKEN=your_telegram_bot_token
ADMIN_IDS=123456789,987654321

# OpenAI GPT
OPENAI_API_KEY=your_openai_api_key

# XTunnel.ru (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
XTUNNEL_API_KEY=–≤–∞—à_–∫–ª—é—á_–∑–¥–µ—Å—å
XTUNNEL_SUBDOMAIN=–≤–∞—à_–ø–æ–¥–¥–æ–º–µ–Ω

# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
MOCK_MODE=false  # true –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ GPT
```

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–±–æ—Ä–∞ –¥–æ–º–æ–≤

### Production Mode (—Å GPT)

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥–æ–±—Ä–∞—Ç—å –¥–æ–º üè†"
2. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –æ–ø—Ä–æ—Å** - GPT –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è—Ö
3. **–ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π** - GPT –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã
4. **–ü–æ–¥–±–æ—Ä –¥–æ–º–∞** - –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–æ–º
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç** - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–º–µ

### Mock Mode (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

1. **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–¥–±–æ—Ä** - –í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π –¥–æ–º –∏–∑ –ë–î
2. **–†–µ–∑—É–ª—å—Ç–∞—Ç** - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫–Ω–æ–ø–∫–æ–π "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"

## üåê API Endpoints

**GET /api/health**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è API

**GET /api/houses**
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–º–æ–≤

**GET /api/houses/{house_id}**
- –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–æ–º–∞

**GET /api/user/{user_id}/recommendations**
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**GET /api/houses/mock/recommendations**
- –°–ª—É—á–∞–π–Ω—ã–µ –¥–æ–º–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üì± Mini App Features

- üè† **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–º–æ–≤** - –ö–∞—Ä—Ç–æ—á–∫–∏ —Å —Ñ–æ—Ç–æ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
- ‚≠ê **–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–æ–∫** - Recommendation scores –∏ match reasons
- üîç **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –ü–æ —Ü–µ–Ω–µ, –ø–ª–æ—â–∞–¥–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–æ–º–Ω–∞—Ç
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
- üí¨ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: Python 3.10+, FastAPI, SQLAlchemy
- **Bot**: aiogram 3.x
- **AI**: OpenAI GPT API
- **Database**: SQLite
- **Frontend**: HTML5, CSS3, JavaScript
- **Tunnel**: XTunnel.ru –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.8+
- Telegram Bot Token
- OpenAI API Key (–¥–ª—è production)
- XTunnel.ru –∞–∫–∫–∞—É–Ω—Ç (–¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
python migrate_db.py  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```

## üìù –õ–æ–≥–∏

–°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª–∞—Ö:
- `xtunnel_server.log` - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
- `bot.log` - Telegram bot
- `local_server.log` - –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å–µ—Ä–≤–µ—Ä

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ XTunnel.ru:
- üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://cabinet.xtunnel.ru/
- üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –¥–ª—è —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.