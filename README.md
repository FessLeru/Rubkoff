# Rubkoff House Selection Bot

Telegram бот для подбора домов от компании Rubkoff. Бот использует GPT для интеллектуального подбора домов на основе предпочтений пользователя.

## Функциональность

- Интерактивный опрос пользователя для выявления предпочтений
- Интеллектуальный подбор домов с помощью GPT
- Автоматический парсинг каталога домов с сайта
- Панель администратора с расширенными возможностями
- Система рассылок и уведомлений
- Сбор статистики использования

## Технологии

- Python 3.9+
- aiogram 3.x (асинхронный Telegram Bot API фреймворк)
- SQLAlchemy (ORM для работы с базой данных)
- OpenAI GPT API (для интеллектуального подбора)
- BeautifulSoup4 (для парсинга сайта)
- SQLite (база данных)

## Структура проекта

```
rubkoff/
├── app/
│   ├── core/           # Конфигурация и база данных
│   ├── models/         # SQLAlchemy модели
│   ├── services/       # Сервисы (GPT, парсер)
│   ├── bot/           # Обработчики бота
│   └── utils/         # Вспомогательные функции
├── migrations/        # Миграции базы данных
└── main.py           # Точка входа
```

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/rubkoff-bot.git
cd rubkoff-bot
```

2. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate     # Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env` на основе `env-sample`:
```bash
cp env-sample .env
```

5. Заполните `.env` необходимыми значениями:
```env
BOT_TOKEN=your_telegram_bot_token
OPENAI_API_KEY=your_openai_api_key
ADMIN_IDS=123456789,987654321
NOTIFICATION_CHAT_ID=-100123456789
```

## Запуск

1. Примените миграции базы данных:
```bash
alembic upgrade head
```

2. Запустите бота:
```bash
python main.py
```

## Администрирование

Для доступа к панели администратора необходимо:
1. Добавить ID администратора в `ADMIN_IDS` в файле `.env`
2. Перезапустить бота
3. Отправить команду `/start` боту
4. Нажать кнопку "Панель администратора"

Функции панели администратора:
- Просмотр статистики использования
- Создание рассылок пользователям
- Обновление каталога домов
- Управление администраторами

## Разработка

### Добавление новых команд

1. Создайте обработчик в соответствующем файле в `app/bot/handlers/`
2. Зарегистрируйте обработчик в роутере
3. При необходимости добавьте новые модели в `app/models/`
4. Обновите тесты

### Миграции базы данных

Создание новой миграции:
```bash
alembic revision --autogenerate -m "описание изменений"
```

Применение миграций:
```bash
alembic upgrade head
```

## Логирование

Логи сохраняются в файл `bot.log`. Уровень логирования настраивается в `.env`:
```env
LOG_LEVEL=DEBUG  # или INFO, WARNING, ERROR
```

## Тестирование

```bash
pytest tests/
```

## Лицензия

MIT License