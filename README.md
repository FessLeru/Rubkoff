# üè† Rubkoff House Selection Bot

Telegram –±–æ—Ç –∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –¥–æ–º–æ–≤ –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ Rubkoff.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ü§ñ **Telegram Bot** —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
- üì± **Mini App** –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–º–æ–≤ –≤ Telegram
- üîç **–£–º–Ω—ã–π –ø–æ–∏—Å–∫** –¥–æ–º–æ–≤ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
- üéØ **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ GPT-4
- üìä **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üåê **REST API** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- üê≥ **Docker** –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## üéØ –°—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥–µ–ø–ª–æ—é

‚úÖ **–ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£!**

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `run_both.py`**
   - –ü—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å —Ç–µ–ø–µ—Ä—å –±–µ—Ä–µ—Ç—Å—è –∏–∑ Docker –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Docker/–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

2. **üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å CORS**
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ CORS –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
   - –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–º–µ–Ω—ã –∏ –º–µ—Ç–æ–¥—ã

3. **üìù –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –º–æ–¥–µ–ª—è—Ö (`house_view`, `survey_finished`)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

4. **üê≥ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω docker-compose.yml –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ volumes –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - Health checks –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

5. **üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - –ü–æ–ª–Ω–∞—è API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`API_DOCUMENTATION.md`)
   - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é (`DEPLOYMENT_GUIDE.md`)
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`env.example`)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
git clone <repository-url>
cd rubkoff

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

# –ó–∞–ø—É—Å–∫
python run_both.py
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (Docker)

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env.example .env
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
python health_check.py

# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
```

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É:

```bash
python health_check.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –§–∞–π–ª–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- ‚úÖ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚úÖ –°–µ—Ç–µ–≤—É—é —Å–≤—è–∑–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ü–æ—Ä—Ç—ã

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
BOT_TOKEN=your_bot_token
ADMIN_IDS=123456789,987654321
OPENAI_API_KEY=your_openai_key

# –ü—Ä–æ–¥–∞–∫—à–µ–Ω URLs (–¥–ª—è Docker)
WEBHOOK_URL=https://your-domain.com/webhook
MINI_APP_URL=https://your-domain.com/frontend/
API_BASE_URL=https://your-domain.com/api

```

–ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä: `env.example`

## üåê API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### üè† Houses (–î–æ–º–∞)

- `GET /api/houses` - –°–ø–∏—Å–æ–∫ –¥–æ–º–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- `GET /api/houses/{id}` - –î–µ—Ç–∞–ª–∏ –¥–æ–º–∞
- `GET /api/houses/mock/recommendations` - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- `POST /api/houses/{id}/view` - –õ–æ–≥ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

### üë§ Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

- `GET /api/user/{id}/recommendations` - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- `GET /api/user/{id}/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/user/{id}/activity` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### üîó System (–°–∏—Å—Ç–µ–º–∞)

- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `GET /api/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ API
- `POST /webhook` - Telegram webhook
- `GET /info` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ

–ü–æ–¥—Ä–æ–±–Ω–æ: [API_DOCUMENTATION.md](API_DOCUMENTATION.md)

## üê≥ Docker

### –ó–∞–ø—É—Å–∫ —Å Docker Compose

```bash
# –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
docker-compose up -d

# –° Traefik (SSL)
docker-compose --profile production up -d

# –¢–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose up app
```

### Environments

- **local**: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **docker**: –ü—Ä–æ–¥–∞–∫—à–µ–Ω –≤ Docker
- **production**: –ü–æ–ª–Ω—ã–π –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å SSL

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```bash
# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose logs -f app

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f

# –õ–æ–≥–∏ —Ñ–∞–π–ª—ã
tail -f logs/app.log
```

### Health Checks

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è API
curl https://your-domain.com/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# Backup
./backup.sh  # (—Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ)

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
git pull origin main
docker-compose build
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker-compose ps
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
rubkoff/
‚îú‚îÄ‚îÄ app/                    # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ api/               # FastAPI —Ä–æ—É—Ç–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ bot/               # Telegram bot –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ core/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ models/            # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ docker-compose.yml     # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile            # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ run_both.py           # –ì–ª–∞–≤–Ω—ã–π –∑–∞–ø—É—Å–∫–∞—Ç–µ–ª—å
‚îú‚îÄ‚îÄ health_check.py       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ requirements.txt      # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –ó–∞–ø—É—Å–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env.example .env
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MOCK_MODE=true –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

# –ó–∞–ø—É—Å–∫
python run_both.py
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìñ [API Documentation](API_DOCUMENTATION.md) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- üöÄ [Deployment Guide](DEPLOYMENT_GUIDE.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é
- ‚öôÔ∏è [env.example](env.example) - –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- ‚úÖ Rate limiting
- ‚úÖ SSL/TLS –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ Docker security best practices

## üéØ Deployment Checklist

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] `python health_check.py` –ø—Ä–æ–π–¥–µ–Ω ‚úÖ
- [ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
- [ ] DNS –∑–∞–ø–∏—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

**–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:**
```bash
docker-compose logs app | grep -i error
curl https://api.telegram.org/bot<TOKEN>/getWebhookInfo
```

**Mini App –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è:**
```bash
curl -I https://your-domain.com/frontend/
curl https://your-domain.com/api/health
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
```bash
docker-compose exec app ls -la /app/data/
docker volume ls | grep rubkoff
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
docker-compose down && docker-compose up -d

# –ß–∏—Å—Ç–∫–∞ (–û–°–¢–û–†–û–ñ–ù–û!)
docker-compose down -v --rmi all

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose exec app /bin/bash

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
docker stats --no-stream
```

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: PostgreSQL + Redis
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Prometheus + Grafana
3. **CI/CD**: GitHub Actions
4. **Load Balancing**: Nginx + –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã

---

## üèÜ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

**‚úÖ PRODUCTION READY** - –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä!

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞, –∫–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.